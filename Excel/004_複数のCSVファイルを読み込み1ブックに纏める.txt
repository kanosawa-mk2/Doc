Sub ImportCSVFiles()
    Dim ws As Worksheet
    Dim folderPath As String
    Dim fileName As String
    Dim filePath As String
    Dim textData As String
    Dim textLines As Variant
    Dim rowNum As Long, colNum As Long
    Dim cellValues As Variant
    Dim i As Integer, j As Integer
    

        ' ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ•ã‚©ãƒ«ãƒ€é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
    With Application.FileDialog(msoFileDialogFolderPicker)
        .Title = "CSVãƒ•ã‚¡ã‚¤ãƒ«ãŒæ ¼ç´ã•ã‚ŒãŸãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠã—ã¦ãã ã•ã„"
        If .Show = -1 Then
            folderPath = .SelectedItems(1) & "\"
        Else
            Exit Sub ' ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸå ´åˆã¯çµ‚äº†
        End If
    End With
    
        ' ç”»é¢æ›´æ–°ã‚’åœæ­¢ï¼ˆå‡¦ç†é€Ÿåº¦å‘ä¸Šï¼‰
    Application.ScreenUpdating = False
    Application.DisplayAlerts = False
    
    ' FileSystemObject ã‚’ä½œæˆ
    Set fso = CreateObject("Scripting.FileSystemObject")
    
    
    ' ğŸ“Œ ãƒ•ã‚©ãƒ«ãƒ€å†…ã®CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢
    fileName = Dir(folderPath & "*.csv")

    ' CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’1ã¤ãšã¤å‡¦ç†
    Do While fileName <> ""
        filePath = folderPath & fileName

        ' ğŸ”¹ CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’UTF-8ã§èª­ã¿è¾¼ã‚€
        textData = ReadUTF8File(filePath)

        ' ğŸ”¹ æ”¹è¡Œã”ã¨ã«åˆ†å‰²ï¼ˆ1è¡Œã”ã¨ã®é…åˆ—ï¼‰
        textLines = Split(textData, vbCrLf)

        ' âœ… æ–°ã—ã„ã‚·ãƒ¼ãƒˆã‚’ä½œæˆï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åã‚’ã‚·ãƒ¼ãƒˆåã«è¨­å®šï¼‰
        Set ws = ThisWorkbook.Sheets.Add
        ws.Name = Left(fileName, Len(fileName) - 4) ' æ‹¡å¼µå­ã‚’é™¤å»

        rowNum = 1

        ' ğŸ“Œ CSVãƒ‡ãƒ¼ã‚¿ã‚’è¡Œã”ã¨ã«å‡¦ç†
        For i = LBound(textLines) To UBound(textLines)
            If Trim(textLines(i)) <> "" Then ' ç©ºè¡Œã¯ã‚¹ã‚­ãƒƒãƒ—
                cellValues = SplitCSVWithNewline(textLines(i)) ' ã‚«ãƒ³ãƒå‡¦ç†ï¼ˆãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰
                
                colNum = 1
                For j = LBound(cellValues) To UBound(cellValues)
                    ' âœ… Excelã®è‡ªå‹•å¤‰æ›ã‚’é˜²ããŸã‚ã«ã€ã™ã¹ã¦æ–‡å­—åˆ—ã¨ã—ã¦æ‰±ã†
                    ws.Cells(rowNum, colNum).Value = "'" & cellValues(j)
                    colNum = colNum + 1
                Next j
                
                rowNum = rowNum + 1
            End If
        Next i

        ' æ¬¡ã®CSVãƒ•ã‚¡ã‚¤ãƒ«ã¸
        fileName = Dir()
    Loop
    
        ' ç”»é¢æ›´æ–°ã‚’å†é–‹
    Application.ScreenUpdating = True
    Application.DisplayAlerts = True
    
    MsgBox "CSVã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸï¼", vbInformation
End Sub

Function ReadUTF8File(filePath As String) As String
    Dim stream As Object
    Dim textData As String

    ' ğŸ”¹ ADODB.Stream ã‚’ä½¿ã£ã¦UTF-8ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ­£ã—ãèª­ã¿è¾¼ã‚€
    Set stream = CreateObject("ADODB.Stream")
    stream.Type = 2 ' ãƒ†ã‚­ã‚¹ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ 
    stream.Charset = "utf-8"
    stream.Open
    stream.LoadFromFile filePath

    ' ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’å–å¾—
    textData = stream.ReadText
    stream.Close
    Set stream = Nothing

    ReadUTF8File = textData
End Function

Function SplitCSVWithNewline(line As String) As Variant
    Dim result() As String
    Dim tempStr As String
    Dim inQuotes As Boolean
    Dim i As Integer
    Dim char As String

    ' åˆæœŸåŒ–
    ReDim result(0)
    tempStr = ""
    inQuotes = False

    ' 1æ–‡å­—ãšã¤è§£æ
    For i = 1 To Len(line)
        char = Mid(line, i, 1)

        ' ğŸ”¹ ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®å‡¦ç†
        If char = """" Then
            If inQuotes And i < Len(line) And Mid(line, i + 1, 1) = """" Then
                ' é€£ç¶šã™ã‚‹ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ï¼ˆ"" â†’ "ï¼‰
                tempStr = tempStr & """"
                i = i + 1
            Else
                ' ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹é–‰ã‚’åˆ‡ã‚Šæ›¿ãˆ
                inQuotes = Not inQuotes
            End If
        ElseIf char = "," And Not inQuotes Then
            ' ğŸ”¹ ã‚«ãƒ³ãƒãŒåŒºåˆ‡ã‚Šæ–‡å­—ã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹ã®ã¯ã€ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å¤–ã®ã¿
            result(UBound(result)) = tempStr
            tempStr = ""
            ReDim Preserve result(UBound(result) + 1)
        Else
            ' é€šå¸¸ã®æ–‡å­—ã‚’è¿½åŠ 
            tempStr = tempStr & char
        End If
    Next i

    ' æœ€å¾Œã®å€¤ã‚’æ ¼ç´
    result(UBound(result)) = tempStr

    SplitCSVWithNewline = result
End Function
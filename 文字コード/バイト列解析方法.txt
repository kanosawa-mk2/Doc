■バイト列解析（バイナリ解析）は、文字化け調査の最強スキルです。
「目に見える文字」ではなく、「実際に送られたバイトの値」を直接見て判断することで、
どの文字コードなのか
どこで壊れたか
を正確に突き止められます。

プログラマが知っておくべきバイト列解析の手順を、実務で使える形でまとめて説明します。



■バイト列解析とは？

簡単に言うと、

文字化けしているデータの “生バイト列” を16進数で確認し、
その値から文字コードを逆算する調査方法のこと
です。

例：
「こんにちは」を UTF-8 にすると
e3 81 93 e3 82 93 e3 81 ab e3 81 a1 e3 81 af
というバイト列になります。



■バイト列解析の全体の流れ（実務で使える版）

1.問題の文字列の“バイト列”を取り出す
2.16進数で並べる（hex dump）
3.バイトパターンから文字コードを推測する
4.推測した文字コードでデコードし直す
5.結果の正当性を確認する
この流れだけで、文字化けの9割は解決できます。



■ステップ①：バイト列を取り出す方法

Windows（PowerShell）
　Get-Content file.txt -Encoding Byte | Format-Hex
　
　
　メモ
　　Format-Hex の出力は、1つの行につき 16 バイト（0x00～0x0F）を表示する形式になっています。
　　左端：オフセット（位置）
　　　　　00000000 → 先頭（0 バイト目）
　　　　　00000010 → 16 バイト目（0x10 = 16）
　　　　　00000020 → 32 バイト目（0x20 = 32）
　　中央：実際のバイト列（16進）。この部分が最重要
　　右端：UTF-8 のバイト列を ANSI（CP932）として強引に解釈した結果の「文字化け」

Linux / macOS
　hexdump -C file.txt
　# または
　xxd file.txt

■プログラム内（例：Java）

byte[] bytes = str.getBytes("UTF-8");
for (byte b : bytes) {
    System.out.printf("%02x ", b);
}


■ステップ②：16進数で確認（hex dump）

例として、文字化けした“Ã‚Â©”のバイト列がこう出たとします：
c3 82 c2 a9

■ステップ③：バイトパターンから文字コードを推測する

ここが最重要ポイントです。

よくある文字コードのパターン
✓ UTF-8
　日本語はだいたい e3 81 xx / e3 82 xx
　記号は c2 xx または c3 xx
　絵文字は f0 9f xx xx

✓ Shift_JIS
　日本語1バイト目は 0x81-0x9F または 0xE0-0xFC
　2バイト目は 0x40-0x7E / 0x80-0xFC
　ASCIIは 1バイト（0x00〜0x7F）

✓ EUC-JP
日本語は 0xA4 0xxx や 0xA5 0xxx
先頭バイトが 0x8E, 0x8F も特徴的

✓ UTF-16（LE）
ASCII文字は常に 41 00（A）、42 00（B）等
00 が挟まるのが特徴

ステップ④：推測した文字コードでデコードする
例のバイト列：
c3 82 c2 a
この並びは UTF-8 の 2バイト文字が2つ並んでいる という典型的な文字化け。

解析すると：
c2 a9 は ©（著作権記号）
しかし、それをさらに 誤って UTF-8 として再エンコードしたことで
c3 82 c2 a9 になった

→ これは「UTF-8 → Shift_JIS と誤認 → UTF-8再エンコード」という事故でよく起きるパターン。


ステップ⑤：妥当性チェック

推測した文字コードで正しく読めるかを確認します。
例のデータで UTF-8 としてデコードすると…
→ 「Ã‚Â©」
これはよくある“重複エンコーディング”の文字化けです。
原因が正しく特定できた証拠。


“文字コード推測”のコツ（実務でよく使う）
✔ 1. 0x00 が頻繁に出る → UTF-16 の可能性が高い
✔ 2. e3 が多い → 日本語の UTF-8
✔ 3. A4 や A5 が多い → EUC-JP
✔ 4. 81–9F, E0–FC がある → Shift_JIS
✔ 5. f0 9f がある → 絵文字（UTF-8）
✔ 6. c2 / c3 で始まる → 記号や“誤再エンコード”の兆候

実務で使えるテクニック集
🔧 ① Webツールでバイト列をチェックする
hex to text
text to hex
などで検索すると便利。

🔧 ② バイト列を複数の文字コードで試しデコードしてみる
→ Java / Python で簡単にできる


🔧 ③ Shift_JIS の「ありえないバイト」を探す
Shift_JISの範囲外のバイトがある → そのデータは Shift_JIS ではない！


🎯 要点まとめ
文字化けトラブルの解決には バイト列解析が最強
hex dump を取って、パターンからコード体系を推測する
主要な文字コードパターンだけ覚えておけば十分
9割のケースは UTF-8 vs Shift_JIS の誤解釈である